# Note: This project has been moved to [zfdatagrid on GitHub](https://github.com/zfdatagrid/). #

#summary Documentation for Bvb\_Grid\_Deploy\_JqGrid class



# Introduction #

This is documentation for **[jqGrid](http://www.trirand.com/blog/jqgrid/jqgrid.html)** front-end implementation for **ZFDatgrid library**. Look at this **[example](http://www.k2s.sk/grid/jqgrid)** to see it in action.

## Current plans ##
  * keep jqGrid front-end as much as possible compatible with HTML Table front-end
  * allow to pass all configuration options of jqGrid from PHP
  * add PHP functions which will provide easy way to complex jqGrid functionality
  * evaluate what parts of Bvb should be improved to use full power of booth libraries
  * provide documentation and examples
  * methods should support chaining

## Future plans ##
  * support for `Bvb_Grid_Filters` definition (actual implementation is not usign the Bvb interpretation)
  * user settings persistence - saving of the state (ordering, current page, filters, etc.) in cookie
  * support [Advanced searching](http://www.trirand.com/jqgridwiki/doku.php?id=wiki:advanced_searching)
  * allow formatters to change jqGrid settings and work with different deploy classes (need Bvb redesign)
    * create set of useful formatters
  * CRUD operations
  * evaluate possibility and usefulness to support:
    * (jqgrid) filter input controls (text and select is supported, but date, date range, etc. should be added)
    * (jqgrid) sortname
    * (jqgrid) column chooser
    * (jqgrid) column reorder
    * (jqgrid) summary footer row, (Bvb) SQL Expressions
    * (jqgrid) autoloading when scrolling
    * (jqgrid) Adjacency List Model
    * (jqgrid) subforms
    * (jqgrid) tree
    * (Bvb) horizontal row
    * not to use ZendX\_JQuery
    * don't need to provide data via Ajax (means always to render the page)

## Installation ##
In general the project which wants to use `Bvb_Grid_Deploy_JqGrid` class has to accomplish:
  * include path set to directories where following libraries are located:
    * Zend
    * ZendX (it is possible to change the class not to use ZendX)
    * Bvb (ZFDataGrid) - [checkout](http://code.google.com/p/zfdatagrid/source/checkout) from code repository or [download](http://code.google.com/p/zfdatagrid/downloads/list) stable version
  * full jqGrid library accessible from URL
    * download from http://www.trirand.com/blog/?page_id=6 (check all modules, we are not testing with other configuration)
    * uncompress to publicly accessible folder (you will not need the src subfolder)
  * configure `Bvb_Grid_Deploy_JqGrid` to use your URL pointing to folder with jqGrid library (best place is to do it in bootsrap)
```
Bvb_Grid_Deploy_JqGrid::$jqgridLibPath = $myurl;
```
  * use `Bvb_Grid_Deploy_JqGrid` instead of `Bvb_Grid_Deploy_Table class`
  * if you already used ZFDatagrid in your project and simple replace of `Bvb_Grid_Deploy_Table` with `Bvb_Grid_Deploy_JqGrid` should work
  * **you have to call function `Bvb_Grid_Deploy_Table::ajax()` before `deploy()`**
  * add output from [ZendX\_JQuery\_View\_Helper\_JQuery](http://framework.zend.com/manual/en/zendx.jquery.html) into your HTML header

<a href='Hidden comment: 
chapter about === Install Sample Project ===
'></a>

## Code ##
  * code formating follows the Zend standard and is checked regularly with [PHP\_CodeSniffer](http://pear.php.net/package/PHP_CodeSniffer)
  * code documentation on [http://www.k2s.sk/gridapi](http://www.k2s.sk/gridapi/library/Bvb/Grid/Deploy/Bvb_Grid_Deploy_JqGrid.class.html) was generated by [phpSimpleDoc](http://www.phpsimpledoc.org/)

# Usage #

Before you continue you should:
  * read actual [ZFDatagrid manual](http://code.google.com/p/zfdatagrid/downloads/list)
  * check [examples of jqGrid](http://www.trirand.com/blog/jqgrid/jqgrid.html)
  * read [jqGrid wiki](http://www.trirand.com/jqgridwiki)

## Steps to configure jqGrid ##
You will find all necessarily steps in our [example](http://www.k2s.sk/grid/jqgrid) (**[view code](http://www.k2s.sk/grid/jqgrid/code)**).

  1. define `Zend_Db_Select` object and pass it to grid
  1. update column options
  1. configure Bvb grid behaviour (available in `Bvb_Grid_DataGrid`)
  1. configure jqGrid options `Bvb_Grid_Deploy_JqGrid`
  1. set ajax ID
  1. deploy and display in view

## Object configuration options ##
TODO explain array notation and set functions
TODO explain Zend\_Config usage

There are 3 categories of options which could be configured in `Bvb_Grid_Deploy_JqGrid`. Names of this options are coming from different domains and their names could collide, so we need to add an domain prefix to them.

| **Option type** | **Prefix** |
|:----------------|:-----------|
| `Bvb_Grid_DataGrid` native options | no prefix  |
| `Bvb_Grid_Deploy_JqGrid` own options | bvb        |
| jqGrid native options | jqg        |

### ZFDatagrid native column options ###
| **Option/Function()** | **Explanation** |
|:----------------------|:----------------|
| title                 | translated to `jqGrid.colModel.name` property |
| width                 | translated to `jqGrid.colModel.width` property |
| align                 | translated to `jqGrid.colModel.align` property |
| remove                || Bvb implementation is removing the field also from result set so this is not the same as `hidden`|
| hidden                | field will not be visible, but will be loaded from DB |
| decorator             | normal behavior |
| <strike>hRow</strike> | not supported, see [#Future\_plans](#Future_plans.md) |
| callback              | normal behavior |
| <strike>eval</strike> | was removed from ZFDatagrid, use callback instead |
| order                 | normal behavior |
| class                 | normal behavior |
| searchType            | normal behavior |
| searchTypeFixed       | normal behavior |
| format                | normal behavior, but formatter have no way to configure jqGrid properies, see see [#Future\_plans](#Future_plans.md) |
| Extra Fields          | normal behavior |
| <strike>SQL Expressions</strike> | see [#Future\_plans](#Future_plans.md) |
| Ajax                  | mandatory to call `ajax()` method |

<sup><code>*</code> check <a href='http://www.k2s.sk/grid/jqgrid'>example</a> <b><a href='http://www.k2s.sk/grid/jqgrid/code'>code</a></b> and <a href='http://www.k2s.sk/gridapi/'>API documentation</a></sup>

### jqGrid column options ###
| **Option/Function()** | **Explanation** |
|:----------------------|:----------------|
| jqg**{jqGrid Property name}** | set parameter from jqGrid domain [jqGrid colModel property](http://www.trirand.com/jqgridwiki/doku.php?id=wiki:colmodel_options) with jqg |
| <strike>bvbNavGrid</strike> | not implemented now |
| <strike>bvbNavButtons</strike> | not implemented now |
| <strike>bvbAddNavButton()</strike> | not implemented now |
| <strike>bvbClearNavButtons()</strike> | not implemented now |

```
$grid->updateColumn('IsBig', array(
    'width'=>40,
    'title' => 'Is Big City', 
    'jqg' => array(
        'formatter'=>'checkbox', 
        'align'=>'center',
        'stype'=>'select',
        'searchoptions'=>array(/*'defaultValue'=>'1', */'value'=>array(null=>'All', 0=>'No', 1=>'Yes'))
    )
));
```

<sup><code>*</code> check <a href='http://www.k2s.sk/grid/jqgrid'>example</a> <b><a href='http://www.k2s.sk/grid/jqgrid/code'>code</a></b> and <a href='http://www.k2s.sk/gridapi/'>API documentation</a></sup>

### ZFDatagrid native options ###
| **Option/Function()** | **Explanation** |
|:----------------------|:----------------|
| noFilters()           | [toolbar searching](http://www.trirand.com/jqgridwiki/doku.php?id=wiki:toolbar_searching) functionality will not be initialized |
| noOrder()             | [viewsortcols](http://www.trirand.com/jqgridwiki/doku.php?id=wiki:options) will be configured not to allow sorting of columns |
| setDefaultFilters()   | normal behavior |
| setPagination()       |                 |
| setPrimary()          | ignored         |

<sup><code>*</code> check <a href='http://www.k2s.sk/grid/jqgrid'>example</a> <b><a href='http://www.k2s.sk/grid/jqgrid/code'>code</a></b> and <a href='http://www.k2s.sk/gridapi/'>API documentation</a></sup>

### jqGrid grid options ###
| **Option/Function()** | **Explanation** |
|:----------------------|:----------------|
| setJqgParams()        | pass array with any [jqGrid options](http://www.trirand.com/jqgridwiki/doku.php?id=wiki:options) |
| setJqgParam()         | set value for param from jqGrid domain, see [jqGrid options](http://www.trirand.com/jqgridwiki/doku.php?id=wiki:options) |
| setBvbParams()        | pass array with own `Bvb_Grid_Deploy_JqGrid` options] |
| setBvbParam()         | set value for param from `Bvb_Grid_Deploy_JqGrid` domain |
| bvbId                 | value of defined column will be set as HTML ID attribute for each row, the value should be unique, see [jqGrid data manupulation manual](http://www.trirand.com/jqgridwiki/doku.php?id=wiki:retrieving_data) |
| bvbFirstDataAsLocal   | if TRUE we will initialize grid with data passed to web page as javascript variable, next data request from grid will be Ajax request, otherwise grid will request first data with Ajax request also |
| bvbSetOnInit()        | adds javascript code to be executed after jqGrid will be initiated in web browser |
| bvbClearOnInit()      | removes all javascript code added by setJqgOnInit() |

<sup><code>*</code> check <a href='http://www.k2s.sk/grid/jqgrid'>example</a> <b><a href='http://www.k2s.sk/grid/jqgrid/code'>code</a></b> and <a href='http://www.k2s.sk/gridapi/'>API documentation</a></sup>

## Setting locale ##
If you like to set default locale for your project call following for example in bootstrap:
```
Bvb_Grid_Deploy_JqGrid::$defaultJqgI18n = "sk";
```

To set locale for grid instance call:
```
$grid->jqgI18n = "sk";
```

## Publishing results ##
Results from `Bvb_Grid_Deploy_JqGrid` object are sent to web browser in situations to display the grid and to provide data to grid.

You need to call `deploy()` function **to render the grid on your HTML page**. This function returns HTML part of the grid and that needs to be added you your controller response. This function also adds javascript code to ZendX jQuery view helper and that need also to be added to controller response.

You could do following in your view script:
```
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
...
  <!-- next line will add all necessery JavaScript and CSS includes -->
  <?php echo $this->jQuery();?>
...
</head>
<body>
...
<!-- next line will output HTML part of grid -->
<?=$this->grid->deploy();?>
...
</body></html>
```

If you are using [Zend\_Layout](http://framework.zend.com/manual/en/zend.layout.html) put the jQuery part into your layout script.

The other situation when results of `Bvb_Grid_Deploy_JqGrid` are sent to web browser is when the **front-end requests data through ajax**. This requests is recognized in `ajax()` function which will send requested data and stop Zend Application. The `ajax()` function should to be called before `deploy()` function.

## Chaining jqGrid methods ##
You may use `Bvb_Grid_Deploy_JqGrid::cmd()` method to call [jqGrid methods](http://www.trirand.com/jqgridwiki/doku.php?id=wiki:methods). The methods are generated to Javascript as chain of commands in jqGrid [new API format](.md).

`Bvb_Grid_Deploy_JqGrid::cmd()` fixes also some non-consistency in jqGrid API:
  * allows to chain jqGrid [post data module](http://www.trirand.com/jqgridwiki/doku.php?id=wiki:post_data_module) methods (setPostData(), appendPostData(), setPostDataItem(), removePostDataItem())
  * it is not possible to call `.trigger()` in the new API style

Example how to use it in view script:
```
<?php $this->jQuery()->onLoadCaptureStart(); ?>
$('#filterShowAllCheckbox').bind('change', function() {
    <?=$this->grid        
        ->cmd('setPostDataItem', 'includeAll', new Zend_Json_Expr('$(this).is(":checked")'))
        ->cmd('trigger', 'reloadGrid');
    ?>
});
<?php $this->jQuery()->onLoadCaptureEnd(); ?>

<?php echo $this->grid->deploy(); ?>
```

Value from jQuery command `$(this).is(":checked")` will be set in `$_POST['includeAll']`. **Take care, that it will be string not boolean.**

# Licence #
Development of this class is sponsored by [XTMotion](http://www.xtmotion.co.uk/) and the code is released under the [same licence](http://code.google.com/p/zfdatagrid/) as ZFDatagrid.

This extension to ZFDatagrid would not exists without the superior [jqGrid library](http://www.trirand.com/jqgridwiki). You may be interested in their original commercial solutions at http://www.trirand.net/.